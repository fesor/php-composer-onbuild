language: bash
services: docker

env:
  - BASE_IMAGE_TAG=7.1.3-fpm
  - BASE_IMAGE_TAG=7.1.4-fpm
  - BASE_IMAGE_TAG=7.0.17-fpm
  - BASE_IMAGE_TAG=7.0.18-fpm

before_script:
  - env | sort
  - image="fesor/php:$BASE_IMAGE_TAG-onbuild"

script:
  - cat Dockerfile.source | envsubst "\$BASE_IMAGE_TAG" > Dockerfile
  - docker build -t $image .

after_success:
  - docker login -u="$DOCKER_LOGIN" -p="$DOCKER_PASS"
  - docker push $image